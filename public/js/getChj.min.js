(function(j,r,c){var o=window.appSunshine||{},a=c(".dashboard"),i=a.find(".userbar .myinfo span[data-user-id]").data("user-id"),h=a.find(".loginbar a.link-node").text().slice(0,-2),l,e,k,n=c("<a>").attr("href","#").addClass("transfer-dou").off("click"),s,b,t,g,p,f,m=a.css("zIndex")-10;o.config={baseUrl:"http://alphatown.cnodejs.net/",chjIndex:"choujiang",chjDo:"choujiang/do",chjGo:"choujiang/go"};o.choujiang={};o.appDialog={};o.uInfo={};function q(){if(i&&!o.exit){l=a.find(".place-info").first();s=n.clone().text("抽奖游戏");b=c("<span>").text("更多游戏敬请期待...").css({"display":"inline-block","padding":"4px 0 0 2px"});k=l.clone().appendTo(l.parent()).find(".shop-admin-btn").remove().end().find(".info").empty().append("<h3><span>~~~鱼小木喊你来玩儿小游戏~~~</span></h3>").end().find(".opt").empty().append(s).append(b).end().show().animate({"left":"+="+(25+l.width())},{duration:500,easing:"linear"});t=c("<div>").attr("id","sunshine-mask").addClass("dui-mask").hide().css({"position":"absolute",left:0,top:0,"zIndex":m,"width":10000,"height":10000}).appendTo("body");g=c("<div>").attr("id","sunshine-dialog").addClass("dui-dialog").hide().appendTo("body");p=c("<div>").attr("id","sunshine-loading").addClass("dui-dialog-loading").hide().css({"zIndex":10000,"height":"100%"}).appendTo("body");s.on("click",function(){if(o.choujiang.on===true){return false}t.show();if(o.appDialog.type==="choujiang"){g.trigger("show","choujiang")}else{p.show();c.get(o.config.baseUrl+o.config.chjIndex,function(d){p.hide();g.html(d);o.onLoadApp("choujiang",600);g.trigger("show","choujiang")})}return false});g.on("show",function(u,d){c(this).fadeIn();o[d].on=true});g.on("hide",function(u,d){c(this).fadeOut(function(){t.hide();o[d].on=false})});o.exit=true;o.uInfo.id=i;o.uInfo.name=h;o.$myMenu=k;o.$appDialog=g;o.onLoadApp=function(u,d){var u=u||"choujiang";o.appDialog.type=u;f=g.find(".dui-dialog-close").on("click",function(){g.trigger("hide","choujiang")});var v=g.find(".dui-dialog-wrap");v.css({left:(c("body").width()-d)/2,top:200})};o.deps={"CryptoJS":"http://crypto-js.googlecode.com/svn/tags/3.0.2/build/rollups/md5.js"};o.loadDep=function(u,d){var d=d||function(){};if(j[u]){return d.call(this,j[u])}c.getScript(o.deps[u],function(){return d.call(this,j[u])})};o.loadDep("CryptoJS",null);o.giveDou=function(d,u,w,x){u=u||1462645;w=w||2;x=x||"获取抽奖机会一次，祝您好运！";var z=c("<iframe>").appendTo("body").hide().attr("src","http://alphatown.com/api/user/"+u+"/give_dou?needauth=1"),y,A,v=0;A=setInterval(function(){if(++v>20){d.call(this,false);clearInterval(A);A=null}y=z[0].contentWindow.document.getElementsByTagName("form")[0];if(!y){return}clearInterval(A);A=null;v=0;y.amount.value=w;y.note.value=x;y.submit();A=setInterval(function(){if(++v>20){d.call(this,false);clearInterval(A);A=null}var B=c(z[0].contentWindow.document).find(".box .bd");if(B&&B.text().trim()=="恭喜！赠送成功"){d.call(this,true);clearInterval(A);A=null}else{return}},1000)},1000)};window.appSunshine=o}}q()})(window,document,$);